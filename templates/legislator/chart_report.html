<!--[if lt IE 10]>
<!DOCTYPE html>
<![endif]-->
{% extends "legislator/nav_base.html" %}
{% load staticfiles %}
{% load ly_extras %} 
{% block title %}
	{% if title %}
		<title>立委投票指南:{{title}}</title>
		<meta property="og:title" content="立委投票指南:{{title}}"/>
		<meta itemprop="name" content="立委投票指南:{{title}}">		
	{% else %}
		<title>立委投票指南:總圖表</title>
		<meta property="og:title" content="立委投票指南:總圖表"/>
		<meta itemprop="name" content="立委投票指南:總圖表">	
	{% endif %}
{% endblock %}
{% block right %}
<div class="page-header">
	<h3>
	{% if title %}{{title}}{% endif %}
	{% if content %}<small> -- {{content}}</small>{% endif %}
	</h3>
</div>
<div class="row-fluid">
<div class="span6">
	<div class="hero-unit">
	<div class="fb-like" data-width="50" data-layout="box_count" data-show-faces="false" data-send="false" href="{{current_url}}"></div>
	{% if index == 'biller' or index == 'proposal' %}
		<p class="lead text-center">	
			</font> <font style="color: #6699FF;"><b>個人</b><font style="color: #FF9999;"><b>平均</b>
		</p>
	{% endif %}
	<canvas id="canvas" width="400" height="300" ></canvas>
	</div>
	<hr>		
	<div class="fb-comments" data-width="400" data-num-posts="3" href={{current_url}}></div>
</div>
<div class="span6">
	{% if ly_obj %}
	<table class="table table-bordered" >
	<thead>
	<tr style="font-weight:bold;background-color: #CCFF99;">
	<th style="width: 15%">立委</th>
	{% if index == 'biller' or index == 'proposal' %}
		<th style="width: 10%">提案數</th><th style="width: 10%">平均提案數</th>
	{% elif index == 'conscience_vote' %}
		<th style="width: 10%">脫黨投票(次)</th><th style="width: 10%">脫黨投票率</th>
	{% else %}
		{% if index == 'vote' %}
			<th style="width: 10%">沒投票表決(次)</th><th style="width: 10%">投票率</th>
		{% elif index == 'ly_hit' %}
			<th style="width: 20%">點閱(次)
		{% else %}
			{% if index == 'ly' %}
				<th style="width: 10%">缺席開會(次)</th><th style="width: 10%">缺席率</th>	
			{% else %}
				<th style="width: 20%">缺席開會(次)</th>
			{% endif %}	
		{% endif %}	
	{% endif %}	  
	<th style="width: 18%">選區</th>
	<th style="width: 31%">行政區</th>
	<th style="width: 20%">委員會</th>
	</tr>
	</thead>
	<tbody>	
		{% for ly in ly_obj %}
			<tr style="background-color: {% cycle '#EEEEEE' 'white' %};"><td>
			{% if index == 'vote' %}<a href="{% url 'legislator:chart_personal_report' legislator_id=ly.id index='vote' %}" rel="tooltip" title="{{ly.name}}的表決出缺席圖表">
			{% elif index == 'conscience_vote' %}<a href="{% url 'legislator:voter_detail' legislator_id=ly.id index='conscience' %}" rel="tooltip" title="{{ly.name}}的投票表決紀錄">			
			{% else %}
				{% if index == 'ly' %}<a href="{% url 'legislator:chart_personal_report' legislator_id=ly.id index='ly' %}" rel="tooltip" title="{{ly.name}}的圖表">
				{% elif index == 'biller' %}<a href="{% url 'legislator:biller_detail' ly.id %}" rel="tooltip" title="{{ly.name}}的法條修正草案">			
				{% else %}<a href="{% url 'legislator:proposer_detail' ly.id %}" rel="tooltip" title="{{ly.name}}的提案">				
				{% endif %}
			{% endif %}
			{% if ly.party == "中國國民黨" %}
			<font color=blue>
			{% elif ly.party == "民主進步黨" %}
			<font color=green>
			{% elif ly.party == "親民黨" %}
			<font color=orange>
			{% elif ly.party == "台灣團結聯盟" %}
			<font color=brown>
			{% elif ly.party == "無黨團結聯盟" %}
			<font color=FF00FF>				
			{% elif ly.party == "無" %}
			<font color=gray>
			{% endif %}	
			{{ ly.name }}</font></a></td>
			{% if index == 'ly_hit' %}
				<td>{{ly.hits}}</td>
			{% elif index == 'vote' %}			
				<td>{{ly.notvote}}</td><td>{{ compare|subtract:ly.notvote|divide:compare }}%</td>				
			{% else %}
				<td>{{ly.totalNum}}</td>
				{% if index == 'biller' or index == 'proposal' %}
					<td>{{ compare }}</td>
				{% elif index == 'conscience_vote' or index == 'ly'%}
					<td>{{ ly.totalNum|divide:compare }}%</td>
				{% endif %}
			{% endif %}
		<td><a href="{% url 'legislator:index_district' ly.district %}" rel="tooltip" title="{{ly.district}}的立委詳細資料">{{ly.district}}</a></td>
		<td>{% if ly.districtDetail %}{{ly.districtDetail}}{% endif %}</td>
		<td><a href="{% url 'legislator:index_committee' ly.committee %}" rel="tooltip" title="{{ly.committee}}委員會的立委詳細資料">{{ ly.committee|truncatechars:7 }}</a></td></tr>
		{% endfor %}
		<tr class="info" ><td colspan=6 style="text-align:center;">#註：
		<font color=blue>中國國民黨</font>&nbsp;-&nbsp;<font color=green>民主進步黨</font>&nbsp;-&nbsp;
		<font color=orange>親民黨</font>&nbsp;-&nbsp;<font color=brown>台灣團結聯盟</font>&nbsp;-&nbsp;
		<font color=FF00FF>無黨團結聯盟</font>&nbsp;-&nbsp;<<font color=gray>無黨籍</font></td>
		</tr>
	</tbody>
	</table>
	{% elif vote_obj %}
	<table class="table table-bordered" >
	<thead>
	<tr style="font-weight:bold;background-color: #CCFF99;">
	<th style="width: 20%">表決日期</th>
	<th style="width: 15%">表決(個)</th>
	{% if index == 'nvote_gbdate' %}<th style="width: 65%">會期</th>{% endif %}
	</tr>
	</thead>
	<tbody>	
		{% for vote in vote_obj reversed %}
			<tr style="background-color: {% cycle '#EEEEEE' 'white' %};">
			{% if index == 'nvote_gbdate' %}
				<td>{{vote.date|date:"Y-m-d"}}</td>
				<td>{{vote.totalNum}}</td>
				<td>{{vote.session}}</td>
			{% elif index == 'nvote_gbmonth' %}
				<td>{{vote.year|floatformat:"0"}} / {{vote.month|floatformat:"0"}}</td>
				<td>{{vote.totalNum}}</td>	
			{% endif %}
			</tr>
		{% endfor %}
	</tbody>
	</table>
	{% endif %}
</div>
</div>
{% endblock %}
{% block backtotop %}	
	<div align="center">
	<a href="#top" class="lead"><i class="icon-arrow-up"></i>回頭</a>
	</div>	  
{% endblock %}
{% block script %}
<script src="https://s3-ap-northeast-1.amazonaws.com/twly.tw/Chart.js"></script>
<script>
$(document).ready( function() {
	$('#chart_report').addClass('active');
	$('.dropdown-toggle').dropdown();
	$("[rel='tooltip']").tooltip();
});
var data = {
	{% if ly_obj %}
		labels : {{ ly_name|as_json }},
	{% elif vote_obj %}
		labels : [
			{% for vote in vote_obj %}
			{% if index == 'nvote_gbdate' %}
				"{{ vote.date|date:"Y-m-d" }}",
			{% elif index == 'nvote_gbmonth' %}
				"{{vote.year|floatformat:"0"}}/{{vote.month|floatformat:"0"}}",
			{% endif %}			

			{% endfor %}
			],
	{% endif %}
	datasets : [
		{
			fillColor : "rgba(151,187,205,0.5)",
			strokeColor : "rgba(151,187,205,1)",
			data : [
				{% if ly_obj %}
					{% for ly in ly_obj %}
						{% if index == 'vote' %}					
							{{ly.notvote}},					
						{% elif index == 'ly_hit'%}
							{{ly.hits}},						
						{% else %}
							{{ly.totalNum}},
						{% endif %}
					{% endfor %}
				{% elif vote_obj %}
					{% for vote in vote_obj %}
						{{vote.totalNum}},
					{% endfor %}				
				{% endif %}
			]
		},
		{% if index == 'biller' or index == 'proposal' %}
		{
			fillColor : "rgba(255,204,204,0.5)",
			strokeColor : "rgba(255,204,204,1)",
			data : [
				{% for ly in ly_obj %}
						{{ compare }},			
				{% endfor %}
			]
		},
		{% endif %}
	]			
}
{% if ly_obj %}
	var options = {
			scaleFontFamily : "'標楷體'",
			scaleFontSize   : 18,
	};
	var myLine = new Chart(document.getElementById("canvas").getContext("2d")).Bar(data,options);
{% elif vote_obj %}
	var myLine = new Chart(document.getElementById("canvas").getContext("2d")).Line(data);
{% endif %}

</script>
{% endblock %}